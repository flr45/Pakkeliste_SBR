{% extends "base.html" %}
{% block content %}
<h2>{{ v.name }}</h2>

{% if logged %}
<form class="row" method="post" action="/vehicle/{{ v.id }}/place/add">
  <input name="name" placeholder="Tilføj rum/kasse..." required>
  <button>Tilføj rum</button>
</form>
{% endif %}

<div class="accordion">
  {% for p in v.places %}
  <details>
    <summary class="summary">
      <b>{{ p.name }}</b>
      <span class="tag">{{ place_counts[p.id] }} enheder</span>
      {% if logged %}
      <span class="actions">
        <form method="post" action="/place/{{ p.id }}/move" class="inline">
          <input type="hidden" name="direction" value="up"><button title="Op">▲</button>
        </form>
        <form method="post" action="/place/{{ p.id }}/move" class="inline">
          <input type="hidden" name="direction" value="down"><button title="Ned">▼</button>
        </form>
        <form method="post" action="/place/{{ p.id }}/rename" class="inline">
          <input name="name" value="{{ p.name }}">
          <button>Omdøb</button>
        </form>
      </span>
      {% endif %}
    </summary>
    <div class="pad">
      {% if logged %}
      <form class="row" method="post" action="/item/add">
        <input type="hidden" name="place_id" value="{{ p.id }}">
        <input name="name" placeholder="Nyt udstyr..." required>
        <input name="quantity" type="number" min="1" value="1" style="max-width:100px">
        <input name="note" placeholder="Note">
        <button>Tilføj</button>
      </form>
      {% endif %}
      <ul class="items">
        {% for it in p.items %}
        <li class="item">
          <div class="grow">
            <div class="item-title">{{ it.name }}</div>
            <div class="muted">Antal: {{ it.quantity }} {% if it.note %} • {{ it.note }}{% endif %}</div>
          </div>
          {% if logged %}
          <form method="post" action="/item/{{ it.id }}/move" class="inline">
            <input type="hidden" name="direction" value="up"><button title="Op">▲</button>
          </form>
          <form method="post" action="/item/{{ it.id }}/move" class="inline">
            <input type="hidden" name="direction" value="down"><button title="Ned">▼</button>
          </form>
          <form method="post" action="/item/{{ it.id }}/delete" class="inline" onsubmit="return confirm('Slette {{ it.name }}?')">
            <button class="danger">Slet</button>
          </form>
          <details class="inline">
            <summary>Redigér</summary>
            <form method="post" action="/item/{{ it.id }}/edit" class="editform">
              <input name="name" value="{{ it.name }}">
              <input name="quantity" type="number" min="1" value="{{ it.quantity }}">
              <input name="note" value="{{ it.note }}">
              <select name="place_id">
                {% for p2 in v.places %}
                <option value="{{ p2.id }}" {% if p2.id == p.id %}selected{% endif %}>Flyt til: {{ p2.name }}</option>
                {% endfor %}
              </select>
              <button>Gem</button>
            </form>
          </details>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
  </details>
  {% endfor %}
</div>

<script>
// Luk alle som standard (mobile friendly). Browser åbner default "closed".
</script>
{% endblock %}
